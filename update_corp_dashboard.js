const fs = require('fs');
const file = 'frontend/src/pages/CorporateDashboard.jsx';
let content = fs.readFileSync(file, 'utf8');

content = content.replace(
    `import { Heart, TrendingUp, Zap, Server, Shield, Send, Download, X } from 'lucide-react';\nimport api from '../services/api';\nimport { jsPDF } from 'jspdf';`,
    `import { Heart, TrendingUp, Zap, Server, Shield, Send, Download, X, Package } from 'lucide-react';\nimport api from '../services/api';\nimport { jsPDF } from 'jspdf';\nimport HistoryDetailsModal from '../components/HistoryDetailsModal';`
);

content = content.replace(
    `    const [showDonate, setShowDonate] = useState(false);\n    const [donation, setDonation] = useState({ title: '', quantity: '', expiry: 2, type: 'servings', category: 'veg', location: '' });\n\n    useEffect(() => {\n        const fetchData = async () => {\n            try {\n                const [predictRes, statsRes] = await Promise.all([\n                    api.get(\`/corporate/predict-surplus\`),\n                    api.get(\`/corporate/stats\`),\n                ]);\n                setWeeklyData(predictRes.data.weeklyTrend || []);\n                setRealStats(statsRes.data);\n                // Build weekly chart: group completed donations by day of week`,
    `    const [showDonate, setShowDonate] = useState(false);\n    const [donation, setDonation] = useState({ title: '', quantity: '', expiry: 2, type: 'servings', category: 'veg', location: '' });\n    const [tickets, setTickets] = useState([]);\n    const [selectedTicket, setSelectedTicket] = useState(null);\n\n    useEffect(() => {\n        const fetchData = async () => {\n            try {\n                const [predictRes, statsRes, foodRes] = await Promise.all([\n                    api.get(\`/corporate/predict-surplus\`),\n                    api.get(\`/corporate/stats\`),\n                    api.get(\`/food\`),\n                ]);\n                setWeeklyData(predictRes.data.weeklyTrend || []);\n                setRealStats(statsRes.data);\n\n                const mappedTickets = (foodRes.data || []).map(d => ({\n                    id: d._id,\n                    food: d.title,\n                    qty: d.quantity?.value || 0,\n                    date: new Date(d.createdAt).toISOString().split('T')[0],\n                    status: d.status,\n                    ngo: d.assignedToNGO ? 'Assigned' : 'Matching...',\n                    donorAddress: d.location?.address || 'Corporate HQ',\n                    meals: d.quantity?.value || 0,\n                    otp: d.otp || 'N/A',\n                }));\n                setTickets(mappedTickets);\n\n                // Build weekly chart: group completed donations by day of week`
);

content = content.replace(
    `            toast.success('Food donation created successfully!');\n            setShowDonate(false);\n            setDonation({ title: '', quantity: '', expiry: 2, type: 'servings', category: 'veg', location: '' });\n        } catch (err) {`,
    `            toast.success('Food donation created successfully!');\n            setShowDonate(false);\n            setDonation({ title: '', quantity: '', expiry: 2, type: 'servings', category: 'veg', location: '' });\n\n            const foodRes = await api.get('/food');\n            const mappedTickets = (foodRes.data || []).map(d => ({\n                id: d._id,\n                food: d.title,\n                qty: d.quantity?.value || 0,\n                date: new Date(d.createdAt).toISOString().split('T')[0],\n                status: d.status,\n                ngo: d.assignedToNGO ? 'Assigned' : 'Matching...',\n                donorAddress: d.location?.address || 'Corporate HQ',\n                meals: d.quantity?.value || 0,\n                otp: d.otp || 'N/A',\n            }));\n            setTickets(mappedTickets);\n        } catch (err) {`
);

content = content.replace(
    `                {/* Tabs */}\n                <div className={\`flex gap-1 p-1 rounded-2xl mb-6 \${isDark ? 'bg-white/5' : 'bg-gray-100'}\`}>\n                    {['overview', 'surplus', 'tiers'].map(tab => (\n                        <button key={tab} onClick={() => setActiveTab(tab)}\n                            className={\`flex-1 py-2.5 rounded-xl text-sm font-semibold capitalize transition-all \${activeTab === tab ? 'text-white' : isDark ? 'text-white/50' : 'text-gray-500'}\`}\n                            style={activeTab === tab ? { background: 'linear-gradient(135deg, #63b3ed, #68d391)' } : {}}>\n                            {tab === 'overview' ? 'üìä Overview' : tab === 'surplus' ? 'ü§ñ AI Surplus' : 'üèÜ CSR Tiers'}\n                        </button>\n                    ))}\n                </div>`,
    `                {/* Tabs */}\n                <div className={\`flex gap-1 p-1 rounded-2xl mb-6 \${isDark ? 'bg-white/5' : 'bg-gray-100'}\`}>\n                    {['overview', 'surplus', 'history', 'tiers'].map(tab => (\n                        <button key={tab} onClick={() => setActiveTab(tab)}\n                            className={\`flex-1 py-2.5 rounded-xl text-sm font-semibold capitalize transition-all \${activeTab === tab ? 'text-white' : isDark ? 'text-white/50' : 'text-gray-500'}\`}\n                            style={activeTab === tab ? { background: 'linear-gradient(135deg, #63b3ed, #68d391)' } : {}}>\n                            {tab === 'overview' ? 'üìä Overview' : tab === 'surplus' ? 'ü§ñ AI Surplus' : tab === 'history' ? 'üç± History' : 'üèÜ CSR Tiers'}\n                        </button>\n                    ))}\n                </div>`
);

content = content.replace(
    `            </div>\n        </div>\n    );\n}`,
    `            </div>\n\n            {activeTab === 'history' && (\n                <div className={\`\${isDark ? 'glass-card' : 'clay-card'} p-6 rounded-3xl max-w-4xl mx-auto\`}>\n                    <div className="flex items-center justify-between mb-5">\n                        <h2 className={\`text-lg font-bold \${isDark ? 'text-white' : 'text-gray-900'}\`}>üç± Corporate Donation History</h2>\n                        <span className={\`text-xs font-semibold px-2.5 py-1 rounded-lg \${isDark ? 'bg-white/10 text-white/60' : 'bg-gray-100 text-gray-500'}\`}>\n                            {tickets.length} records\n                        </span>\n                    </div>\n                    <div className="space-y-3">\n                        {tickets.map((t, i) => (\n                            <motion.div key={t.id} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: i * 0.06 }}\n                                onClick={() => setSelectedTicket(t)}\n                                className={\`flex items-center justify-between p-4 rounded-2xl cursor-pointer hover:scale-[1.01] transition-transform \${isDark ? 'bg-white/5 hover:bg-white/10' : 'bg-gray-50 hover:bg-gray-100'}\`}>\n                                <div className="flex items-center gap-3">\n                                    <div className="w-10 h-10 rounded-xl flex items-center justify-center text-lg"\n                                        style={{ background: isDark ? 'rgba(99,179,237,0.15)' : '#e8f4fd' }}>üì¶</div>\n                                    <div>\n                                        <div className="flex items-center gap-2 mb-0.5">\n                                            <div className={\`text-sm font-semibold \${isDark ? 'text-white' : 'text-gray-900'}\`}>{t.food}</div>\n                                            {t.otp && t.otp !== 'N/A' && (\n                                                <div className={\`text-[10px] font-mono font-bold px-2 py-0.5 rounded-md \${isDark ? 'bg-[#63b3ed]/20 text-[#63b3ed]' : 'bg-blue-100 text-blue-700'}\`}>\n                                                    OTP: {t.otp}\n                                                </div>\n                                            )}\n                                        </div>\n                                        <div className={\`text-xs \${isDark ? 'text-white/40' : 'text-gray-400'}\`}>{t.id} ¬∑ {t.date} ¬∑ {t.ngo}</div>\n                                    </div>\n                                </div>\n                                <div className="text-right">\n                                    <div className={\`text-sm font-bold \${isDark ? 'text-white' : 'text-gray-900'}\`}>{t.qty} meals</div>\n                                    <span className={\`text-xs px-2 py-0.5 rounded-full font-semibold \${t.status === 'delivered' ? 'bg-green-100 text-green-600' : t.status === 'active' ? 'bg-blue-100 text-blue-600' : 'bg-gray-100 text-gray-500'}\`}>\n                                        {t.status}\n                                    </span>\n                                </div>\n                            </motion.div>\n                        ))}\n                    </div>\n                </div>\n            )}\n            <HistoryDetailsModal \n                isOpen={!!selectedTicket} \n                onClose={() => setSelectedTicket(null)} \n                ticket={selectedTicket} \n                isDark={isDark} \n            />\n        </div>\n    );\n}`
);

fs.writeFileSync(file, content);
console.log('Done replacing via NodeJS script');
